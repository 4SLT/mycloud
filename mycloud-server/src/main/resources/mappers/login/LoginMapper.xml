<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.fslt.mycloudserver.modules.login.mapper.LoginMapper">

    <sql id="selectLogin">
        ${table}.id AS id
        ,${table}.user_name AS userName
        ,${table}.user_password AS userPassword
        ,${table}.profile_photo_url AS profilePhotoUrl
        ,${table}.phone AS phone
        ,${table}.email AS email
        ,${table}.create_time AS createTime
        ,${table}.delete_flag AS deleteFlag
        ,${table}.status AS status
    </sql>


    <select id="getPasswordByUserName" parameterType="com.fslt.mycloudserver.modules.user.domain.CloudUser"
            resultType="java.lang.String">
        SELECT
            cu.user_password AS userPassword
        FROM
            t_cloud_user cu
        WHERE
            cu.user_name = #{userName, jdbcType = VARCHAR}
            AND cu.STATUS = 1
            AND cu.delete_flag = 0
    </select>

    <select id="queryPhone" parameterType="com.fslt.mycloudserver.modules.user.domain.CloudUser"
            resultType="java.lang.Integer">
        SELECT
            count( * )
        FROM
            t_cloud_user cu
        WHERE
            cu.phone = #{phone, jdbcType = VARCHAR}
            AND cu.STATUS = 1
            AND cu.delete_flag = 0
    </select>

    <select id="queryEmail" parameterType="com.fslt.mycloudserver.modules.user.domain.CloudUser"
            resultType="java.lang.Integer">
        SELECT
            count( * )
        FROM
            t_cloud_user cu
        WHERE
            cu.email = #{email, jdbcType = VARCHAR}
            AND cu.STATUS = 1
            AND cu.delete_flag = 0
    </select>

    <select id="getRegisterFlag" parameterType="com.fslt.mycloudserver.modules.user.domain.CloudUser"
            resultType="java.lang.Integer">
        SELECT
            COUNT( * )
        FROM
            t_cloud_user cu
        WHERE
            cu.user_name = #{userName, jdbcType = VARCHAR}
            AND cu.status = 1
            AND cu.delete_flag = 0
    </select>

    <insert id="register" parameterType="com.fslt.mycloudserver.modules.user.domain.CloudUser">
        INSERT INTO t_cloud_user
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="userName != null">
                user_name,
            </if>
            <if test="userPassword != null">
                user_password,
            </if>
            <if test="profilePhotoUrl != null">
                profile_photo_url,
            </if>
            <if test="phone != null">
                phone,
            </if>
            <if test="email != null">
                email,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="userName != null">
                #{userName, jdbcType = VARCHAR},
            </if>
            <if test="userPassword != null">
                #{userPassword, jdbcType = VARCHAR},
            </if>
            <if test="profilePhotoUrl != null">
                #{profilePhotoUrl, jdbcType = VARCHAR},
            </if>
            <if test="phone != null">
                #{phone, jdbcType = VARCHAR},
            </if>
            <if test="email != null">
                #{email, jdbcType = VARCHAR},
            </if>
        </trim>
    </insert>

</mapper>